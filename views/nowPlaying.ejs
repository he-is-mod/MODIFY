<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Now Playing</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Poppins&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="/nowPlaying.css">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>

<body>
  <div class="d-flex justify-content-center align-items-center min-vh-100">
    <div class="glass-card text-center p-4">
      <% if (track) { %>
        <img src="<%= track.cover || '/default-cover.jpg' %>" alt="Album Art" class="album-art mb-3">
        <h2 class="track-title"><%= track.title %></h2>
        <p class="artist-name"><%= track.artist_name || "Unknown Artist" %></p>


        <!-- Audio element hidden, controlled with JS -->
        <audio id="audioPlayer">
          <source src="<%= track.url %>" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>

        <!-- Custom Controls -->
        <div class="mt-3 d-flex justify-content-center gap-3 gap-md-4 align-items-center">
          <button class="btn btn-outline-light rounded-circle control-btn" onclick="location.href='/nowPlaying/nowPlaying/prev'">
            <i class="fas fa-backward"></i>
          </button>

          <button class="btn btn-outline-light rounded-circle control-btn" id="playPauseBtn">
            <i class="fas fa-play"></i>
          </button>

          <button class="btn btn-outline-light rounded-circle control-btn" onclick="location.href='/nowPlaying/nowPlaying/next'">
            <i class="fas fa-forward"></i>
          </button>
        </div>

        <!-- Progress bar and time display -->
        <div class="progress-container mt-3">
          <div id="progressBar" class="progress-bar"></div>
        </div>

        <div class="time-display d-flex justify-content-center align-items-center text-white mt-1">
          <span id="currentTime">0:00</span>
          <span class="mx-2">/</span>
          <span id="totalDuration">0:00</span>
        </div>

      <% } else { %>
        <p class="text-white">No track is currently playing.</p>
      <% } %>
    </div>
  </div>

 <footer class="footer-nav">
  <div class="footer-icons d-flex justify-content-around align-items-center">
    <a href="/home"><i class="fas fa-home"></i></a>
    <% if (user) { %>
      <% if (user.role === 'musician') { %>
        <a href="/musician/profile"><i class="fas fa-user"></i></a>
      <% } else if (user.role === 'listener') { %>
        <a href="/listener/profile"><i class="fas fa-user"></i></a>
      <% } else { %>
        <a href="/"><i class="fas fa-user"></i></a>
      <% } %>
    <% } else { %>
      <a href="/login"><i class="fas fa-user"></i></a>
    <% } %>
    <a href="/nowPlaying/nowPlaying"><i class="fas fa-music"></i></a>
    <a href="/search"><i class="fas fa-search"></i></a>
  </div>
</footer>

 

  <script>
    const audio = document.getElementById("audioPlayer");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const currentTimeEl = document.getElementById("currentTime");
    const totalDurationEl = document.getElementById("totalDuration");
    const progressBar = document.getElementById("progressBar");
    const progressContainer = document.querySelector('.progress-container');

    let isPlaying = false;

    playPauseBtn.addEventListener("click", () => {
      if (isPlaying) {
        audio.pause();
        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
      } else {
        audio.play();
        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
      }
      isPlaying = !isPlaying;
    });

    audio.addEventListener("timeupdate", () => {
      const current = formatTime(audio.currentTime);
      const total = formatTime(audio.duration);
      currentTimeEl.textContent = current;
      totalDurationEl.textContent = total;

      const progressPercent = (audio.currentTime / audio.duration) * 100;
      progressBar.style.width = `${progressPercent}%`;
    });

    progressContainer.addEventListener('click', (e) => {
      const width = progressContainer.clientWidth;
      const clickX = e.offsetX;
      const duration = audio.duration;

      audio.currentTime = (clickX / width) * duration;
    });

    function formatTime(seconds) {
      if (isNaN(seconds)) return "0:00";
      const min = Math.floor(seconds / 60);
      const sec = Math.floor(seconds % 60).toString().padStart(2, "0");
      return `${min}:${sec}`;
    }

    window.addEventListener("load", () => {
      audio.play();
      isPlaying = true;
      playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
    });
  </script>
</body>
</html>